#+TITLE: My configuration of Emacs
#+STARTUP: showeverything
#+STARTUP: inlineimages
#+auto_tangle: t
#+AUTHOR: Prutserdt

#+CAPTION: Doom Emacs
#+ATTR_HTML: :alt Doom Emacs :title Doom Emacs :align center
[[https://github.com/Prutserdt/dotfiles/raw/master/.doom.d/doom-emacs.png]]

* Table Of Contents :toc:
- [[#about-this-config][About this config]]
- [[#initel][init.el]]
- [[#packagesel][packages.el]]
- [[#configel][config.el]]
- [[#code-snippets][Code snippets]]
- [[#credits][Credits]]

* About this config
This is my personal [[https://github.com/hlissner/doom-emacs][Doom Emacs]] config. Nothing much to see here. Just started this journey and learning [[https://www.gnu.org/software/emacs/][Emacs]] and [[https://en.wikipedia.org/wiki/Literate_programming][literate programming]] along the way. The Emacs Lisp files [[https://github.com/Prutserdt/dotfiles/blob/master/.doom.d/init.el][init.el]], [[https://github.com/Prutserdt/dotfiles/blob/master/.doom.d/packages.el][packages.el]] and [[https://github.com/Prutserdt/dotfiles/blob/master/.doom.d/config.el][config.el]] are generated from [[https://github.com/Prutserdt/dotfiles/blob/master/.doom.d/README.org][this README.org file]] by tangling in Emacs ~M-x~ ~org-babel-tangle~. Remember to run =~/.emacs.d/bin/doom sync= in the terminal, or ~M-x~ ~doom/reload~ in Doom Emacs, after modifying this README.org!

* init.el
This file controls what Doom modules are enabled and what order they load in and the first line of the file is lexical binding. This makes the file run (sligthly) faster.
#+begin_src emacs-lisp :tangle init.el
;;; init.el -*- lexical-binding: t; -*-
#+end_src

Add a note to ~init.el~ to highlight that this file should not be edited directly.
#+begin_src emacs-lisp :tangle init.el
;; NOTE: This file is generated from ~/.doom.d/README.org
;;      Please only edit that file and org-babel-tangle (emacs)
#+end_src

The list of available modules can be checked in Doom Emacs by ~M-x~ ~Doom/help-modules~ and can be added to the list of modules listed below.
#+begin_src emacs-lisp :tangle init.el

(doom! :completion
       company           ; the ultimate code completion backend
       vertico           ; the search engine of the future
       (ivy +childframe) ; a search engine for love and life

       :ui
       doom              ; what makes DOOM look the way it does
       doom-dashboard    ; a nifty splash screen for Emacs
       (emoji +unicode)  ; ð
       hl-todo           ; highlight TODO/FIXME/NOTE/DEPRECATED/HACK/REVIEW
       modeline          ; snazzy, Atom-inspired modeline, plus API
       ophints           ; highlight the region an operation acts on
       (popup +defaults) ; tame sudden yet inevitable temporary windows
       vc-gutter         ; vcs diff in the fringe
       vi-tilde-fringe   ; fringe tildes to mark beyond EOB
       workspaces        ; tab emulation, persistence & separate workspaces
       treemacs          ; a project drawer, like neotree but cooler

       :editor
       (evil +everywhere); come to the dark side, we have cookies
       file-templates    ; auto-snippets for empty files
       fold              ; (nigh) universal code folding
       snippets          ; my elves. They type so I don't have to

       :emacs
       (dired +icons)    ; making dired pretty [functional]
       electric          ; smarter, keyword-based electric-indent
       undo              ; persistent, smarter undo for your inevitable mistakes
       vc                ; version-control and :Emacs, sitting in a tree

       :term
       vterm             ; the best terminal emulation in Emacs

       :checkers
       syntax            ; tasing you for every semicolon you forget

       :tools
       debugger          ; stepping through code, to help you add bugs
       (eval +overlay)   ; run code, run (also, repls)
       lookup            ; navigate your code and its documentation
       lsp               ; M-x vscode
       magit             ; a git porcelain for Emacs

       :lang
       emacs-lisp        ; drown in parentheses
       markdown          ; writing docs for people to ignore
       (org +pretty)     ; organize your plain life in plain text
       (python +lsp
        +pyright)        ; beautiful is better than ugly
       sh                ; she sells {ba,z,fi}sh shells on the C xor
       php               ; perl's insecure younger brother
       latex


       :app

       :config
       (default +bindings +smartparens)
       )
#+end_src

#+RESULTS:

* packages.el
Here the packages are defined which should be installed. This is an addition to the already installed and loaded modules of ~init.el~. This file shouln't be byte compiled.
#+begin_src emacs-lisp :tangle packages.el
;; -*- no-byte-compile: t; -*-
#+end_src

Again a NOTE is added to ~packages.el~ to *not* edit this file.
#+begin_src emacs-lisp :tangle packages.el
;; NOTE: This file is generated from ~/.doom.d/README.org
;;      Please only edit that file and org-babel-tangle (emacs)
#+end_src

A package can be installed from MELPA, ELPA or emacsmirror by (package! package_name). The beacon package is not part of the Doom Emacs modules and is added here. /Never lose your cursor again/ by highlighting the cursor after scrolling.
#+begin_src emacs-lisp :tangle packages.el
(package! beacon)
#+end_src

Centering text to the middle of the window can be done by the visual-fill-column package.
#+begin_src emacs-lisp :tangle packages.el
(package! visual-fill-column)
#+end_src

Web-mode for editing of html/php/css
#+begin_src emacs-lisp :tangle packages.el
(package! web-mode)
#+end_src

Adding arduino-mode, testing, not working properly yet FIXME
#+begin_src emacs-lisp :tangle packages.el
(package! arduino-cli-mode)
(package! arduino-mode)
#+end_src

Settings for python hacking, not sure I will use this setup, FIXME
#+begin_src emacs-lisp :tangle packages.el
(package! org-babel-eval-in-repl)
(package! eval-in-repl)
(package! jupyter)
(package! phpactor)
(package! org-auto-tangle)
#+end_src



* config.el
The custom configurations are set here. For instance theme settings, image to the doom splash screen, transparency, relative numbering and email settings.

Let's remind the reader of ~config.el~ to not edit this file directly.
#+begin_src emacs-lisp :tangle config.el
;; NOTE: This file is generated from ~/.doom.d/README.org
;;      Please only edit that file and org-babel-tangle (emacs)
#+end_src

The default setting of Evil mode in Doom Emacs is to use Y in normal mode to yank the whole line from the cursor position. This is obviously the *incorrect* way and is reverted here to copy the whole line, regardless of cursor position.
#+begin_src emacs-lisp :tangle config.el
(setq! evil-want-Y-yank-to-eol nil)
#+end_src

The Doom Emacs welcome screen is modified here. A different image is used, the default widgets are removed and alternative text is added.
#+begin_src emacs-lisp :tangle config.el
(setq fancy-splash-image "~/.doom.d/doom-emacs.png")
(remove-hook '+doom-dashboard-functions #'doom-dashboard-widget-shortmenu)
(add-hook! '+doom-dashboard-functions :append
  (insert "\n" (+doom-dashboard--center +doom-dashboard--width "A melodramatic vimmer spirals into despair before he succumbs to the dark side: this config.")))
#+end_src

Test: kan ik sql gebruiken in org code blocks....
#+begin_src emacs-lisp :tangle config.el
(org-babel-do-load-languages
 'org-babel-load-languages
 '((sql . t)))
#+end_src

Finding the cursor can be tricky after scrolling or page up/down. The beacon module comes to the resque by highlighing the cursor area. /Never lose your cursor again/. Because I'm slow I set the blinkin duration to a whole 3 seconds.
#+begin_src emacs-lisp :tangle config.el
(beacon-mode 1)
(setq beacon-blink-duration 3)
#+end_src

Another trick to make the cursor stand out more in Evil mode is to use the color tomato for the cursor in normal mode. It pops right out. A white bar is set for insert mode and a hollow orange cursor for visual mode. This helps to differentiate between normal/insert/visual mode.
#+begin_src emacs-lisp :tangle config.el
(setq evil-normal-state-cursor '(box "tomato")
      evil-insert-state-cursor '(bar "white")
      evil-visual-state-cursor '(hollow "orange"))
#+end_src

More eye candy by superstar bullets in org mode instead of the default boring *. This requires (org +pretty) in ~init.el~.
#+begin_src emacs-lisp :tangle config.el
(setq org-superstar-headline-bullets-list '("◉" "○" "✿" "✸" "⁖" ))
#+end_src

Flashing of yanked text is already set out of the box in Doom Emacs. I'm kinda slow and like the flashing to take longer. The default is 0.2 second and set it here to a whole second.
#+begin_src emacs-lisp :tangle config.el
(setq evil-goggles-duration 1.0)
#+end_src

Elisp is parentheses galore! The package rainbow-delimiters is matching the colors of parenthesis and this helps navigating code. Also handy for other languages.
#+begin_src emacs-lisp :tangle config.el
(use-package rainbow-delimiters)
#+end_src

The superior font is set here.
#+begin_src emacs-lisp :tangle config.el
(set-frame-font "Hack 12" t t)
(setq default-frame-alist '((font . "Hack 13")))
#+end_src

Hide emphasis markup (e.g. /italic/, *bold*, ~code~, etc)
#+begin_src emacs-lisp :tangle config.el
(setq org-hide-emphasis-markers t)
#+end_src

For ultrawide monitors I prefer to set my working window in the middle of the screen. In my case I use qtile window manager with monadthreecolumn and emacs in the middle column. With visual-fill emacs can be set to be in the middle of the window. This works with the three column layout and is especially nice for maximized windows on an ultrawide. Now it's perfectly in the middle and distraction free.
#+begin_src emacs-lisp :tangle config.el
(setq-default fill-column 110)
(global-display-fill-column-indicator-mode)
(add-hook 'visual-line-mode-hook 'visual-fill-column-mode)
(setq-default visual-fill-column-center-text t)
#+end_src

Set relative numbering. In Doom Emacs it can also be toggled by ~SPC~ ~t~ ~l~.
#+begin_src emacs-lisp :tangle config.el
(global-display-line-numbers-mode)
(setq display-line-numbers-type 'relative)
#+end_src

Emacs and Doom Emacs use a lot of keybindings. I try not to interfere with those and use the available ~SPC~ ~d~. This area is under construction. Probably it is better to just use the already present doom keybindings and use them. This part is just an excercize to map a set of keybindings.
#+begin_src emacs-lisp :tangle config.el
(map! :leader
      (:prefix ("d" . "Personal Bindings")
          (:prefix ("b" . "Buffer options")
                :desc "Kill current buffer"     "k" #'kill-this-buffer
                :desc "Kill some buffers"       "K" #'kill-some-buffers
                :desc "Open a buffer"           "o" #'buffer-menu)
       :desc "Search hotkey key briefly"        "d" #'describe-key-briefly
       :desc "Describe function"                "h" #'describe-function
       :desc "Increase font size"               "i" #'doom/increase-font-size
       :desc "Find a file"                      "f" #'find-file
;      :desc "Open recent files"                "o" #'recentf-open-more-files
       :desc "Open recent files"                "o" #'counsel-recentf
       :desc "Reload Doom: doom/reload"         "r" #'doom/reload
       :desc "Tangling: org-babel-tangle"       "t" #'org-babel-tangle
       :desc "Hide org blocks"                  "L" #'org-fold-hide-block-all
       :desc "Laat zien org blocks"             "l" #'org-fold-show-all
       :desc "Plak keuze uit kill ring"         "p" #'consult-yank-from-kill-ring
       :desc "Huidige org block aan/uit"        "s" #'org-fold-hide-block-toggle
       :desc "Treemacs file navigation"         "." #'treemacs
       :desc "Write this buffer to file"        "w" #'write-file)
                )
#+end_src

Arduino .ino files are a type of C++ code. Let's help Emacs remember this by setting this as a major mode.
#+begin_src emacs-lisp :tangle config.el
(add-to-list 'auto-mode-alist '("\\.ino\\'" . c-mode))
#+end_src

Get a glimpse of the desktop background by setting a low transparency for Emacs.
NOTE: when this part is placed at the start of ~config.el~ then transparency does not work.
#+begin_src emacs-lisp :tangle config.el
(set-frame-parameter (selected-frame) 'alpha '(95 90))
(add-to-list 'default-frame-alist '(alpha 95 90))
#+end_src

Remove the scroll bar. NOTE: does not work when it's at the start of config.el.
#+begin_src emacs-lisp :tangle config.el
(scroll-bar-mode -1)
#+end_src

Kijken of ik middle mouse button kan gebruiken om te pasten....
Op zich werkt het want via mijn keyboard kan ik met derde muisbutton dit laten werken, alleen werkt het niet vanuit de muis. Dat is vreemd... TODO: dit moet ik nog oplossen
#+begin_src emacs-lisp :tangle config.el
(global-set-key (kbd "<mouse-2>") 'clipboard-yank)
;; misschien is deze ook nodig:...
(delete-selection-mode)
;; https://www.emacswiki.org/emacs/CopyAndPaste
#+end_src

No more conformation message after closing emacs.
#+begin_src emacs-lisp :tangle config.el
(setq confirm-kill-emacs nil)
#+end_src

Automatically tangling by this package
#+begin_src emacs-lisp :tangle config.el
(use-package org-auto-tangle
  :load-path "site-lisp/org-auto-tangle/"    ;; this line is necessary only if you cloned the repo in your site-lisp directory
  :defer t
  :hook (org-mode . org-auto-tangle-mode))
#+end_src

* Code snippets

Code snippets can automate lots of stuff. Here below is an example. In org-mode <p tab will insert the following snippet:

#+begin_src snippet :tangle snippets/org-mode/PythonBlock
# -*- mode: snippet -*-
# name: PythonBlock
# key: <p
# --
#+begin_src python :tangle ${2:wismij}.py :results output
# NOTE, this file is generated from the org file:
# `(file-name-nondirectory (buffer-file-name))`
# Only modify the org file and not this Python file.

$0
#+end_sr${1:c}
#+end_src

Remark: Github cannot handle a code block inside a codeblock. The line ~#+begin_src python :tangle ${2:wismij}.py :results output~ under the line ~# --~ is actually in this README.org file but not showing on the Github page. Also the bottom line ~#+end_sr${1:c}~ is not showing on the github page. Check the [[https://raw.githubusercontent.com/Prutserdt/dotfiles/master/.doom.d/README.org][raw README.org]] file for that.

* Credits
My configuration of Doom Emacs is partially based on these ones.
- :book: https://gitlab.com/zzamboni/dot-doom
- :book: https://gitlab.com/dwt1/dotfiles/-/tree/master/.emacs.d.gnu
